<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>public</access>
        <active>true</active>
        <api_name>x_8821_dev_toolbox.emailHelper</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>emailHelper</name>
        <script><![CDATA[var emailHelper = Class.create();
emailHelper.prototype = {
	initialize: function() {
	},
	buildContent:function(recordGR){//, email_actionGR){
		var returnHTML = '';
		//First we need to check if the recordGR has a definition in the sys_property
		//We'll do this by looking at the property, "x_8821_dev_toolbox.email_config"
		var emailConfig = JSON.parse(gs.getProperty('x_8821_dev_toolbox.email_config'));
		var table = recordGR.getTableName().toLowerCase();
		if(emailConfig[table]){
			gs.info(table  + ' configured');
			//get theme
			var theme = new GlideRecord('sys_ui_message');
			theme.addQuery('key',emailConfig[table].theme);
			theme.setLimit(1);
			theme.query();
			if(theme.next()){
				returnHTML += theme.getValue('message');
			} else {
				var genericTheme = new GlideRecord('sys_ui_message');
				genericTheme.addEncodedQuery('key=' + emailConfig.generic.theme);
				genericTheme.query();
				if(genericTheme.next()){
					returnHTML += genericTheme.getValue('message');
				}
			}
			//get body
			var body = new GlideRecord('sys_ui_message');
			body.addQuery('key',emailConfig[table].body);
			body.setLimit(1);
			body.query();
			if(body.next()){
				returnHTML += body.getValue('message');
				//('[[COMPANYLOGO]]', 'https://dev84821.service-now.com/sn-logo-dark-green-email.png')
			} else {
				var genericBody = new GlideRecord('sys_ui_message');
				genericBody.addEncodedQuery('key=' + emailConfig.generic.body);
				genericBody.query();
				if(genericBody.next()){
					returnHTML += body.getValue('message');
				} else {
					gs.addErrorMessage('Generic Body mail.generic.body not found');
				}
			}
		} else {
			gs.info(table  + ' not configured');
			//get theme
			var themeGeneric = new GlideRecord('sys_ui_message');
			themeGeneric.addQuery('key',emailConfig.generic.theme);
			themeGeneric.setLimit(1);
			themeGeneric.query();
			if(themeGeneric.next()){
				returnHTML += themeGeneric.getValue('message');
			}
			//get body
			var bodyGeneric = new GlideRecord('sys_ui_message');
			bodyGeneric.addQuery('key',emailConfig.generic.body);
			bbodyGenericody.setLimit(1);
			bodyGeneric.query();
			if(bodyGeneric.next()){
				returnHTML += bodyGeneric.getValue('message');
			}
		}
		
		returnHTML = returnHTML.replace(/\[\[IMAGEURL\]\]/gm, 'https://dev84821.service-now.com/sn-logo-dark-green-email.png');
		returnHTML = returnHTML.replace(/\[\[CompanyName\]\]/gm, 'Dev84821');
		returnHTML = returnHTML.replace(/\[\[SummaryText\]\]/gm, recordGR.getValue('short_description') || 'An update');
		return returnHTML;
	},
	type: 'emailHelper'
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>jacebenson</sys_created_by>
        <sys_created_on>2019-09-22 02:46:14</sys_created_on>
        <sys_id>f774ff15db448010f9a85c7a489619bd</sys_id>
        <sys_mod_count>12</sys_mod_count>
        <sys_name>emailHelper</sys_name>
        <sys_package display_value="Developer Toolbox" source="x_8821_dev_toolbox">57533b78db4623008096a455ca9619ba</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="Developer Toolbox">57533b78db4623008096a455ca9619ba</sys_scope>
        <sys_update_name>sys_script_include_f774ff15db448010f9a85c7a489619bd</sys_update_name>
        <sys_updated_by>jacebenson</sys_updated_by>
        <sys_updated_on>2019-09-22 03:11:14</sys_updated_on>
    </sys_script_include>
</record_update>
